<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 3941.2795952691013 4717.873909584141" width="3941.2795952691013" height="4717.873909584141">
  <!-- svg-source:excalidraw -->
  
  <defs>
    <style class="style-fonts">
      @font-face {
        font-family: "Virgil";
        src: url("https://excalidraw.com/Virgil.woff2");
      }
      @font-face {
        font-family: "Cascadia";
        src: url("https://excalidraw.com/Cascadia.woff2");
      }
    </style>
    
  </defs>
  <g transform="translate(685 10) rotate(0 871.1166381835938 127.54057625080532)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="102.032461000644px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Log shipping / streaming replication</text><text x="0" y="127.540576250805" font-family="Virgil, Segoe UI Emoji" font-size="102.032461000644px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">    Additional configuration</text></g><g transform="translate(10 519.2072429174768) rotate(0 1017.6416625976562 60.83333333333212)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="97.33333333333103px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Preparing the Primary for Standby Servers</text></g><g transform="translate(77.93171777481257 719.2072429174805) rotate(0 1593.469364958035 45.83333333333394)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="73.3333333333344px" fill="#2f9e44" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">continuous archiving on the primary to an archive directory accessible from the standby</text></g><g transform="translate(156.66666666666788 1114.738320249242) rotate(0 1564.383382161459 38.06779466745138)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="60.908471467922936px" fill="#2f9e44" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">set up authentication on the primary server to allow replication connections from the standby server(s)</text></g><g transform="translate(339.1240310077919 952.5405762508126) rotate(0 1636.72965116277 45.83333333333394)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="73.33333333333394px" fill="#e03131" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">The archive location should be accessible from the standby even when the primary is down</text></g><g stroke-linecap="round"><g transform="translate(1610 915.8739095841447) rotate(0 -38.41296403085289 -38.586733253052444)"><path d="M-0.22 -1.15 C-13.18 -13.84, -63.77 -63.57, -76.61 -76.02" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 10"></path></g><g transform="translate(1610 915.8739095841447) rotate(0 -38.41296403085289 -38.586733253052444)"><path d="M-49.28 -63.66 C-62.05 -68.52, -69.91 -74.51, -76.61 -76.02" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 8"></path></g><g transform="translate(1610 915.8739095841447) rotate(0 -38.41296403085289 -38.586733253052444)"><path d="M-63.62 -48.98 C-70.72 -59.64, -72.88 -71.46, -76.61 -76.02" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 8"></path></g></g><mask></mask><g transform="translate(463.3333333333321 1302.5405762508126) rotate(0 1351.066650390625 37.5666666666657)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="65.3333333333314px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">CREATE USER replicator WITH REPLICATION LOGIN ENCRYPTED PASSWORD 'replicator';</text></g><g stroke-linecap="round"><g transform="translate(1223.3333333333321 1382.540576250809) rotate(0 299.9146743752608 -0.011734838735719677)"><path d="M0 -0.08 C100.01 -0.1, 500.03 0.03, 600.01 0.03 M-0.18 0.19 C99.81 0.19, 499.84 -0.19, 599.89 -0.22" stroke="#e03131" stroke-width="4" fill="none"></path></g></g><mask></mask><g transform="translate(1701.6143679151173 1512.540576250809) rotate(0 645.7428445255136 50.83333333333394)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="81.33333333333431px" fill="#e03131" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">user with a replication priviledge</text></g><g stroke-linecap="round"><g transform="translate(1842.7495900438335 1505.873909584141) rotate(0 -24.867232838249038 -46.98140517285174)"><path d="M-0.42 -0.33 C-8.73 -15.95, -41.15 -78.17, -49.31 -93.63" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 10"></path></g><g transform="translate(1842.7495900438335 1505.873909584141) rotate(0 -24.867232838249038 -46.98140517285174)"><path d="M-27.14 -73.43 C-36.62 -81.39, -45.42 -89.65, -49.31 -93.63" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 8"></path></g><g transform="translate(1842.7495900438335 1505.873909584141) rotate(0 -24.867232838249038 -46.98140517285174)"><path d="M-45.31 -63.9 C-47.54 -75.61, -49.08 -87.67, -49.31 -93.63" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 8"></path></g></g><mask></mask><g transform="translate(149.00629237911198 1685.873909584141) rotate(0 719.5801667987253 47.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="75.99999999999972px" fill="#2f9e44" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">provide a suitable entry or entries in </text></g><g transform="translate(520 1862.5405762508126) rotate(0 1131.324951171875 40.850815527821396)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="71.0448965701231px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"># Allow the user "foo" from host 192.168.1.100 to connect to the primary</text></g><g transform="translate(520 1971.0813904551687) rotate(0 1083.433349609375 40.850815527821396)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="71.04489657012311px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"># as a replication standby if the user's password is correctly supplied.</text></g><g transform="translate(520 2079.6222046595212) rotate(0 19.741666793823242 40.850815527821396)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="71.04489657012309px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">#</text></g><g transform="translate(520 2188.1630188638774) rotate(0 1106.75830078125 40.850815527821396)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="71.04489657012309px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge"># TYPE  DATABASE        USER            ADDRESS                 METHOD</text></g><g transform="translate(520 2296.70383306823) rotate(0 918.5416870117188 40.850815527821396)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="71.0448965701231px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">host    replication     foo             192.168.1.100/32        md5</text></g><g transform="translate(570.142008463532 2580.4614761186604) rotate(0 1540.9459431965497 45.20621673273672)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="72.32994677237875px" fill="#e03131" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">standby server can connect to the replication pseudo-database on the primary server</text></g><g stroke-linecap="round"><g transform="translate(2810 2532.540576250809) rotate(0 -193.90562837844118 -78.38745572244079)"><path d="M-0.79 -0.77 C-65.46 -26.81, -322.72 -129.99, -387.02 -156.01" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 10"></path></g><g transform="translate(2810 2532.540576250809) rotate(0 -193.90562837844118 -78.38745572244079)"><path d="M-357.04 -155 C-369.87 -156.18, -379.05 -155.85, -387.02 -156.01" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 8"></path></g><g transform="translate(2810 2532.540576250809) rotate(0 -193.90562837844118 -78.38745572244079)"><path d="M-364.7 -135.96 C-374.62 -144.42, -380.84 -151.44, -387.02 -156.01" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 8"></path></g></g><mask></mask><g transform="translate(1576.6666666666642 1685.4504260584617) rotate(0 197.23333485921103 42.711741762841484)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="68.33878682054748px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">pg_hba.conf</text></g><g transform="translate(160.00000000000364 2771.04229905556) rotate(0 327.7250061035156 49.91580526429061)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="79.8652884228636px" fill="#2f9e44" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Replication Slots</text></g><g transform="translate(423.3333333333394 2925.873909584134) rotate(0 1643.0421930665543 79.2298355121311)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="63.38386840970508px" fill="#e03131" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">Replication slots provide an automated way to ensure that the primary does not remove WAL segments </text><text x="0" y="79.22983551213134" font-family="Virgil, Segoe UI Emoji" font-size="63.38386840970508px" fill="#e03131" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">until they have been received by all standbys</text></g><g transform="translate(536.6666666666679 3206.0426430151747) rotate(0 1174.6416422526036 37.81652928633957)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="65.7678770197205px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">postgres=# SELECT * FROM pg_create_physical_replication_slot('node_a_slot');</text></g><g transform="translate(536.6666666666679 3306.521344017525) rotate(0 229.39591733908492 37.81652928633957)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="65.7678770197205px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">slot_name  | lsn</text></g><g transform="translate(536.6666666666679 3407.000045019875) rotate(0 216.2271132435235 37.81652928633957)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="65.7678770197205px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">-------------+-----</text></g><g transform="translate(536.6666666666679 3507.478746022225) rotate(0 196.557653753649 37.81652928633957)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="65.7678770197205px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">node_a_slot |</text></g><g transform="translate(536.6666666666679 3708.436148026929) rotate(0 1123.8695244913633 37.81652928633957)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="65.7678770197205px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">postgres=# SELECT slot_name, slot_type, active FROM pg_replication_slots;</text></g><g transform="translate(536.6666666666679 3808.914849029279) rotate(0 431.32767127142506 37.81652928633957)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="65.7678770197205px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">slot_name  | slot_type | active</text></g><g transform="translate(536.6666666666679 3909.3935500316293) rotate(0 388.66988433182087 37.81652928633957)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="65.7678770197205px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">-------------+-----------+--------</text></g><g transform="translate(536.6666666666679 4009.8722510339794) rotate(0 368.726375295395 37.81652928633957)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="65.76787701972052px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">node_a_slot | physical  | f</text></g><g transform="translate(536.6666666666679 4110.3509520363295) rotate(0 101.69662697386957 37.81652928633957)"><text x="0" y="0" font-family="Helvetica, Segoe UI Emoji" font-size="65.7678770197205px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">(1 row)</text></g><g transform="translate(516.0729580578336 4390.873909584141) rotate(0 534.3968298903565 52.8125773524589)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="84.50012376393444px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">max_slot_wal_keep_size</text></g><g transform="translate(1810.0000000000036 4280.873909584141) rotate(0 1060.6397976345488 47.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="76.00000000000001px" fill="#e03131" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">limits the size of WAL files retained by replication slots</text></g><g stroke-linecap="round"><g transform="translate(1789.4640794198021 4380.873909584137) rotate(0 -91.5726862145093 32.20257593319002)"><path d="M-0.88 -0.62 C-31.09 10.34, -152.08 53.96, -182.26 65.03" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 10"></path></g><g transform="translate(1789.4640794198021 4380.873909584137) rotate(0 -91.5726862145093 32.20257593319002)"><path d="M-159.27 45.76 C-165.38 49.25, -169.25 53.86, -182.26 65.03" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 8"></path></g><g transform="translate(1789.4640794198021 4380.873909584137) rotate(0 -91.5726862145093 32.20257593319002)"><path d="M-152.26 65.05 C-159.76 64.33, -165.14 64.79, -182.26 65.03" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 8"></path></g></g><mask></mask><g transform="translate(511.666666666697 4575.873909584141) rotate(0 501.7833489311997 57.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="91.9999999999987px" fill="#f08c00" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">max_replication_slots</text></g><g transform="translate(1876.6666666666679 4607.873909584137) rotate(0 968.3333333333685 50.00000000000182)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="80.00000000000283px" fill="#e03131" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">specifies the maximum number of replication slots</text></g><g stroke-linecap="round"><g transform="translate(1845.1666666666679 4663.873909584141) rotate(0 -144.71938602992668 -10.47982275864888)"><path d="M0.03 -0.01 C-48.2 -3.51, -241.23 -17.46, -289.47 -20.95" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 10"></path></g><g transform="translate(1845.1666666666679 4663.873909584141) rotate(0 -144.71938602992668 -10.47982275864888)"><path d="M-260.61 -29.15 C-268.29 -26.9, -275.83 -24.58, -289.47 -20.95" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 8"></path></g><g transform="translate(1845.1666666666679 4663.873909584141) rotate(0 -144.71938602992668 -10.47982275864888)"><path d="M-262.09 -8.68 C-269.39 -11.87, -276.54 -14.99, -289.47 -20.95" stroke="#e03131" stroke-width="4.5" fill="none" stroke-dasharray="1.5 8"></path></g></g><mask></mask></svg>